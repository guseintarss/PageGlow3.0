{% extends 'base.html' %}

{% block head %}
<!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ HTMX -->
<script src="https://unpkg.com/htmx.org@1.9.10"></script>

<!-- CSRF-—Ç–æ–∫–µ–Ω -->
<meta name="csrf-token" content="{{ csrf_token }}">

<!-- –û–±—Ä–∞–±–æ—Ç–∫–∞ CSRF –¥–ª—è HTMX -->
<script>
document.body.addEventListener('htmx:configRequest', function (event) {
    event.detail.headers['X-CSRFToken'] = document.querySelector('meta[name="csrf-token"]').content;
});
</script>

{% endblock %}

{% block content %}
<div class="post">

    <div class="user-photo">
        {% if user.photo %}
        <p><img class="user-img-article" src="{{ user.photo.url }}">
        {% else %}
        <p><img class="user-img-article" src="{{ default_image }}">
        {% endif %}
    </div>

    <h1>{{user.username}}</h1>
    <p><span class="span">{{user.last_name}} {{user.first_name}}</span></p>
      

    <div class="author-stats">
        <span><strong>{{ published_posts.count }}</strong> —Å—Ç–∞—Ç–µ–π</span>
        <span><strong>{{ subscribers_count }}</strong> –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤</span>
        <span><strong>{{ subscriptions_count }}</strong> –ø–æ–¥–ø–∏—Å–æ–∫</span>
    </div>

    {%if user.about_me%}
    <p>{{user.about_me}}</p>
    {%endif%}
    <hr>
    <h4>–ü–æ—Å—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {{user.username}}</h4>
    <a class="a-link position-absolute bottom-0 mb-1 p-3 end-0" href="{% url 'users:edit_profile' %}">
        <svg  xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" >
        <path d="M5 21h14c1.1 0 2-.9 2-2v-7h-2v7H5V5h7V3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2"/><path d="M7 13v3c0 .55.45 1 1 1h3c.27 0 .52-.11.71-.29l9-9a.996.996 0 0 0 0-1.41l-3-3a.996.996 0 0 0-1.41 0l-9.01 8.99A1 1 0 0 0 7 13m10-7.59L18.59 7 17.5 8.09 15.91 6.5zm-8 8 5.5-5.5 1.59 1.59-5.5 5.5H9z"/></svg>
    </a>  
</div>

<div class="post">
  <ul class="nav nav-underline">
          <li class="nav-item">
            <a href="#published" class="nav-link tab" aria-current="page">–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã–µ </a>
          </li>
          <li class="nav-item">
            <a href="#drafts" class="nav-link tab" aria-current="page">–ß–µ—Ä–Ω–æ–≤–∏–∫–∏ </a>
          </li>
          <li class="nav-item">
            <a href="#favorites" class="nav-link tab" aria-current="page">–ò–∑–±—Ä–∞–Ω–Ω—ã–µ </a>
          </li>
  </ul>
</div>
      <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –≤–∫–ª–∞–¥–æ–∫ -->
      <div id="published" class="content-tab">
          {% for post in published_posts %}
              <article class="post">
                  <h3><a href="{{ post.get_absolute_url }}">{{ post.title }}</a></h3>
                    <p class="meta">
                        –ö–∞—Ç–µ–≥–æ—Ä–∏—è: {{ post.cat.name }} 
                        &bull; {{ post.time_update|date:"d.m.Y" }}
                        &bull; üëÅ {{ post.views }}
                        &bull; ‚ù§Ô∏è {{ post.number_of_likes }}
                    </p>
                    {% if post.photo %}
                        <p><img class="img-article-left thumb" src="{{post.photo.url}}" alt=""></p>
                    {% endif %}
                  {% autoescape off %}
                  <p class="meta">{{ post.meta }}</p>
                  {{ post.content|truncatewords:20|safe }}
                  {% endautoescape %}
                  <p><a class="read-more" href="{% url 'edit_page' post.slug %}">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Å—Ç</a></p>
                  <p><a class="read-more" href="{{ post.get_absolute_url }}">–ß–∏—Ç–∞—Ç—å –¥–∞–ª–µ–µ‚Üí</a></p>
                  <p><a class="delete-post" href="{% url 'users:article-delete' post.slug %}"><svg  xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" >
              <path d="M17 6V4c0-1.1-.9-2-2-2H9c-1.1 0-2 .9-2 2v2H2v2h2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8h2V6zM9 4h6v2H9zM6 20V8h12v12z"></path><path d="M9 10h2v8H9zm4 0h2v8h-2z"></path>
              </svg></a></p>
              </article>
          {% empty %}
              <p>–ù–µ—Ç –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ—Å—Ç–æ–≤.</p>
          {% endfor %}
      </div>

      <div id="drafts" class="content-tab" style="display: none;">
          {% for post in drafts %}
              <article class="post">
                  <h3>{{ post.title }}</h3>
                  <p class="meta">–ö–∞—Ç–µ–≥–æ—Ä–∏—è: {{post.cat.name}} &bull; –î–∞—Ç–∞: {{post.time_update|date:"d.m.Y"}} {{post.author.username|default:'–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}}</p>
                      {% if post.photo %}
                        <p><img class="img-article-left thumb" src="{{post.photo.url}}" alt=""></p>
                    {% endif %}
                  {% autoescape off %}
                  <p class="meta">{{ post.meta }}</p>
                  {{ post.content|truncatewords:20|safe }}
                  {% endautoescape %}
                  <p><a class="read-more" href="{% url 'edit_page' post.slug %}">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Å—Ç</a></p>
                  <p><a class="delete-post" href="{% url 'users:article-delete' post.slug %}"><svg  xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" >
              <path d="M17 6V4c0-1.1-.9-2-2-2H9c-1.1 0-2 .9-2 2v2H2v2h2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8h2V6zM9 4h6v2H9zM6 20V8h12v12z"></path><path d="M9 10h2v8H9zm4 0h2v8h-2z"></path>
              </svg></a></p>
              </article>
          {% empty %}
              <p>–ù–µ—Ç —á–µ—Ä–Ω–æ–≤–∏–∫–æ–≤.</p>
          {% endfor %}
      </div>

      <div id="favorites" class="content-tab" style="display: none;">
          {% for post in favorites %}
              <article class="post">
                  <h3><a href="{{ post.get_absolute_url }}">{{ post.title }}</a></h3>
                    <p class="meta">
                        –ö–∞—Ç–µ–≥–æ—Ä–∏—è: {{ post.cat.name }} 
                        &bull; {{ post.time_update|date:"d.m.Y" }}
                        &bull; üëÅ {{ post.views }}
                        &bull; ‚ù§Ô∏è {{ post.number_of_likes }}
                    </p>                      {% if post.photo %}
                        <p><img class="img-article-left thumb" src="{{post.photo.url}}" alt=""></p>
                    {% endif %}
                  {% autoescape off %}
                  <p class="meta">{{ post.meta }}</p>
                  {{ post.content|truncatewords:20|safe }}
                  {% endautoescape %}
                  <p><a class="read-more" href="{{ post.get_absolute_url }}">–ß–∏—Ç–∞—Ç—å –¥–∞–ª–µ–µ‚Üí</a></p>
              </article>
          {% empty %}
              <p>–ù–µ—Ç –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö –ø–æ—Å—Ç–æ–≤.</p>
          {% endfor %}
      </div>

<!-- 
{% for p in posts %}
<article class="post">

   {% if p.is_published == True %}<p><span class="p-2 mb-2 bg-success text-white">–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ</span></p>{% elif p.is_published == False %}<p><span class="p-2 mb-2 bg-warning text-dark">–ß–µ—Ä–Ω–æ–≤–∏–∫</span></p>{% endif %}
    <h2>{{ p.title }}</h2>
    <p class="meta">–ö–∞—Ç–µ–≥–æ—Ä–∏—è: {{p.cat.name}} &bull; –î–∞—Ç–∞: {{p.time_update|date:"d.m.Y"}} {{p.author.username|default:'–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}}</p>
    {% if p.photo %}
        <p><img class="img-article-left thumb" src="{{p.photo.url}}" alt=""></p>
    {% endif %}
    <div class="post-content">
        {% autoescape off %}
        <p class="meta">{{ p.meta }}</p>
        {{ p.content|truncatewords:20|safe }}
        {% endautoescape %}
    </div>
    <p><a class="read-more" href="{% url 'edit_page' p.slug %}">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Å—Ç</a></p>
    <p><a class="read-more" href="{{ p.get_absolute_url }}">–ß–∏—Ç–∞—Ç—å –¥–∞–ª–µ–µ‚Üí</a></p>
    <p><a class="delete-post" href="{% url 'users:article-delete' p.slug %}"><svg  xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" >
<path d="M17 6V4c0-1.1-.9-2-2-2H9c-1.1 0-2 .9-2 2v2H2v2h2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8h2V6zM9 4h6v2H9zM6 20V8h12v12z"></path><path d="M9 10h2v8H9zm4 0h2v8h-2z"></path>
</svg></a></p>
</article>
{% empty %}
<p>–ü–æ—Å—Ç–æ–≤ –Ω–µ—Ç</p>
{% endfor %} -->
{% endblock %}

{% block extra_js %}
<script>
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', function(e) {
                e.preventDefault();
                const target = this.getAttribute('href').replace('#', '');
                document.querySelectorAll('.content-tab').forEach(tab => {
                    tab.style.display = tab.id === target ? 'block' : 'none';
                });
            });
        });
    </script>
<script>
    document.querySelectorAll('.nav-link').forEach(link => {
  link.addEventListener('click', function(e) {
    e.preventDefault(); // –æ—Ç–º–µ–Ω—è–µ–º –ø–µ—Ä–µ—Ö–æ–¥ –ø–æ —Å—Å—ã–ª–∫–µ
    const filter = this.dataset.filter; // –ø–æ–ª—É—á–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ data-filter
    loadArticles(filter); // –≤—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–µ–π
    // –æ–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –≤–∫–ª–∞–¥–∫—É
    document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
    this.classList.add('active');
  });
});
</script>
{%endblock%}